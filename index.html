<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fridge Roulette â€” Eat What You Want</title>
  <style>
    :root{
      --bg:#f7f8fc;
      --card:#ffffff;
      --text:#111827;
      --muted:rgba(17,24,39,.65);
      --line:rgba(17,24,39,.12);
      --shadow:0 18px 45px rgba(0,0,0,.10);
      --accent:#3b82f6;
      --danger:#ef4444;
      --good:#10b981;
      --tile:#f1f5f9;
      --tile2:#eef2ff;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(59,130,246,.16), transparent 60%),
        radial-gradient(1000px 600px at 80% 25%, rgba(236,72,153,.12), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:20px;
    }
    .wrap{
      width:min(980px, 100%);
      display:grid;
      gap:14px;
    }
    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:12px;
      flex-wrap:wrap;
    }
    h1{
      margin:0;
      font-size:20px;
      letter-spacing:.2px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.98), rgba(255,255,255,.92));
      border:1px solid var(--line);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .topbar{
      display:flex;
      gap:10px;
      padding:14px;
      border-bottom:1px solid var(--line);
      align-items:center;
      flex-wrap:wrap;
    }
    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      background:rgba(17,24,39,.04);
      border:1px solid var(--line);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
    }
    .pill b{ font-weight:800; }
    .targets{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    .target{
      display:flex;
      align-items:center;
      gap:8px;
      border:1px solid var(--line);
      background:rgba(59,130,246,.08);
      padding:8px 10px;
      border-radius:999px;
      font-size:14px;
    }
    .target.done{
      background:rgba(16,185,129,.12);
      border-color:rgba(16,185,129,.35);
      text-decoration:line-through;
      opacity:.85;
    }
    .msg{
      margin-left:auto;
      color:var(--muted);
      font-size:13px;
      white-space:nowrap;
    }

    .content{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:14px;
      padding:14px;
    }
    @media (max-width: 860px){
      .content{ grid-template-columns:1fr; }
      .msg{ margin-left:0; white-space:normal; }
    }

    /* Fridge */
    .fridge{
      background:linear-gradient(180deg, rgba(59,130,246,.10), rgba(236,72,153,.06));
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      position:relative;
    }
    .fridge:before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:14px;
      border:1px dashed rgba(17,24,39,.14);
      pointer-events:none;
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(5, 1fr);
      gap:10px;
    }
    @media (max-width: 520px){
      .grid{ grid-template-columns:repeat(4, 1fr); }
    }

    .tileBtn{
      border:1px solid var(--line);
      background:linear-gradient(180deg, #ffffff, var(--tile));
      border-radius:14px;
      height:78px;
      cursor:pointer;
      position:relative;
      overflow:hidden;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .08s ease, background .2s ease;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:30px;
    }
    .tileBtn:active{ transform: translateY(1px); }
    .tileBtn.closed{
      background:linear-gradient(180deg, #ffffff, var(--tile2));
    }
    .tileBtn.closed::after{
      content:"ğŸ§Š";
      position:absolute;
      right:10px; bottom:10px;
      font-size:14px;
      opacity:.55;
    }
    .tileBtn.open{
      background:#ffffff;
    }
    .tileBtn.open.good{
      outline:3px solid rgba(16,185,129,.22);
      border-color:rgba(16,185,129,.35);
    }
    .tileBtn.open.bad{
      outline:3px solid rgba(239,68,68,.22);
      border-color:rgba(239,68,68,.35);
    }

    /* Side panel */
    .side{
      background:rgba(255,255,255,.85);
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      display:grid;
      gap:10px;
      align-content:start;
    }
    .stat{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(17,24,39,.03);
      font-size:13px;
    }
    .big{
      font-size:18px;
      font-weight:900;
    }
    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    button{
      appearance:none;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.95), rgba(17,24,39,.02));
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
      transition:.15s transform;
    }
    button:active{ transform: translateY(1px); }
    .primary{
      background:linear-gradient(180deg, rgba(59,130,246,.20), rgba(59,130,246,.06));
      border-color:rgba(59,130,246,.35);
    }
    .danger{
      background:linear-gradient(180deg, rgba(239,68,68,.16), rgba(239,68,68,.05));
      border-color:rgba(239,68,68,.28);
    }
    .note{
      color:var(--muted);
      font-size:12px;
      line-height:1.5;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      font-size:13px;
      width:max-content;
    }
    .shake{
      animation: shake .25s linear 1;
    }
    @keyframes shake{
      0%{ transform:translateX(0); }
      25%{ transform:translateX(-4px); }
      50%{ transform:translateX(4px); }
      75%{ transform:translateX(-3px); }
      100%{ transform:translateX(0); }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>ğŸ§Š Fridge Roulette â€” Eat What You Want</h1>
        <p class="sub">ì¹¸ì„ ì—´ì–´ â€œì˜¤ëŠ˜ì˜ ì†Œì› ìŒì‹ 3ê°œâ€ë¥¼ ì œí•œ ì‹œê°„ ì•ˆì— ì°¾ì•„ë³´ì. ğŸ¤¢(ìœ í†µê¸°í•œ) ëœ¨ë©´ -3ì´ˆ!</p>
      </div>
      <p class="sub">ëª¨ë°”ì¼: ê·¸ëƒ¥ íƒ­í•˜ë©´ ë¨ Â· ë¦¬í”Œë ˆì´: New Game</p>
    </header>

    <section class="card">
      <div class="topbar">
        <div class="pill"><b>Targets</b> <span style="color:var(--muted)">ì˜¤ëŠ˜ ë¨¹ê³  ì‹¶ì€ ê²ƒ 3ê°œ</span></div>
        <div class="targets" id="targets"></div>
        <div class="msg" id="msg">New Gameì„ ëˆŒëŸ¬ ì‹œì‘!</div>
      </div>

      <div class="content">
        <div class="fridge">
          <div class="grid" id="grid" aria-label="fridge grid"></div>
        </div>

        <aside class="side">
          <div class="stat"><span>â³ Time</span><span class="big" id="time">â€”</span></div>
          <div class="stat"><span>ğŸ§Š Opened</span><span class="big" id="opened">0</span></div>
          <div class="stat"><span>ğŸ† Best</span><span class="big" id="best">â€”</span></div>

          <div class="btnRow">
            <button class="primary" id="newBtn">New Game</button>
            <button id="peekBtn">Peek (1s)</button>
            <button class="danger" id="resetBestBtn">Reset Best</button>
          </div>

          <div class="badge" id="modeBadge">Difficulty: <b>Normal</b></div>
          <div class="btnRow">
            <button id="easyBtn">Easy</button>
            <button id="normalBtn">Normal</button>
            <button id="hardBtn">Hard</button>
          </div>

          <p class="note">
            - ëª©í‘œ 3ê°œë¥¼ ë‹¤ ì°¾ìœ¼ë©´ ìŠ¹ë¦¬ ğŸ‰<br/>
            - ğŸ¤¢ë¥¼ ì—´ë©´ ì‹œê°„ì´ ê¹ì—¬ìš” (-3s)<br/>
            - Peekì€ 1ì´ˆ ë™ì•ˆ ì „ì²´ê°€ ì‚´ì§ ë³´ì´ëŠ” â€œëƒ‰ì¥ê³  ë¬¸ ì—´ê¸°â€<br/>
            - BestëŠ” â€œí´ë¦¬ì–´ê¹Œì§€ ê±¸ë¦° ì‹œê°„(ë¹ ë¥¼ìˆ˜ë¡ ì¢‹ìŒ)â€ìœ¼ë¡œ ê¸°ë¡
          </p>
        </aside>
      </div>
    </section>
  </div>

<script>
(() => {
  // ===== Config =====
  const FOOD_POOL = [
    "ğŸ•","ğŸ”","ğŸŸ","ğŸŒ­","ğŸ¥ª","ğŸ¥—","ğŸ¥™","ğŸ¥Ÿ","ğŸœ","ğŸ£",
    "ğŸ™","ğŸ±","ğŸ›","ğŸ","ğŸ—","ğŸ¥©","ğŸ¥“","ğŸ§€","ğŸ¥","ğŸ¥–",
    "ğŸ°","ğŸ§","ğŸ©","ğŸª","ğŸ«","ğŸ¦","ğŸ§","ğŸ“","ğŸ‡","ğŸ‰",
    "ğŸŠ","ğŸŒ","ğŸ¥­","ğŸ’","ğŸ§‹","â˜•","ğŸ¥›","ğŸ¥‘","ğŸŒ®","ğŸ«”"
  ];
  const BAD = "ğŸ¤¢";
  const STORAGE_BEST = "fridgeRoulette_best_v1";

  const gridEl = document.getElementById("grid");
  const targetsEl = document.getElementById("targets");
  const msgEl = document.getElementById("msg");
  const timeEl = document.getElementById("time");
  const openedEl = document.getElementById("opened");
  const bestEl = document.getElementById("best");

  const newBtn = document.getElementById("newBtn");
  const peekBtn = document.getElementById("peekBtn");
  const resetBestBtn = document.getElementById("resetBestBtn");

  const easyBtn = document.getElementById("easyBtn");
  const normalBtn = document.getElementById("normalBtn");
  const hardBtn = document.getElementById("hardBtn");
  const modeBadge = document.getElementById("modeBadge");

  // ===== Difficulty presets =====
  const DIFFS = {
    easy:   { cols:4, rows:4, time:26, badRate:0.10, penalty:2, peekCooldown:6 },
    normal: { cols:5, rows:4, time:22, badRate:0.14, penalty:3, peekCooldown:8 },
    hard:   { cols:5, rows:5, time:20, badRate:0.18, penalty:4, peekCooldown:10 },
  };
  let diffKey = "normal";
  let diff = DIFFS[diffKey];

  // ===== State =====
  let tiles = [];              // { value, open, hitType: "good"|"bad"|null }
  let targets = [];            // array of 3 emoji
  let found = new Set();
  let openedCount = 0;

  let totalTime = diff.time;
  let timeLeft = diff.time;
  let running = false;
  let timerId = null;
  let startedAt = null;

  let peekLockedUntil = 0; // timestamp in ms

  // ===== Helpers =====
  const rand = (n) => (Math.random() * n) | 0;
  const shuffle = (arr) => {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = (Math.random() * (i + 1)) | 0;
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  };

  function loadBest(){
    const raw = localStorage.getItem(STORAGE_BEST);
    const v = raw ? Number(raw) : null;
    return Number.isFinite(v) ? v : null;
  }
  function saveBest(sec){
    localStorage.setItem(STORAGE_BEST, String(sec));
  }
  function formatSec(s){
    return `${s.toFixed(1)}s`;
  }

  function setMessage(s){
    msgEl.textContent = s;
  }

  function setDiff(key){
    diffKey = key;
    diff = DIFFS[diffKey];
    modeBadge.innerHTML = `Difficulty: <b>${diffKey[0].toUpperCase() + diffKey.slice(1)}</b>`;
    // ë°˜ì‘í˜• ê·¸ë¦¬ë“œ ì»¬ëŸ¼ ë³€ê²½
    gridEl.style.gridTemplateColumns = `repeat(${diff.cols}, 1fr)`;
    // ìƒˆ ê²Œì„ ì¤€ë¹„
    stopTimer();
    renderTime("--");
    setMessage("New Gameì„ ëˆŒëŸ¬ ì‹œì‘!");
    buildEmptyGrid();
  }

  function renderBest(){
    const b = loadBest();
    bestEl.textContent = b == null ? "â€”" : formatSec(b);
  }

  function renderTime(v){
    timeEl.textContent = (typeof v === "string") ? v : formatSec(v);
  }

  function stopTimer(){
    running = false;
    if(timerId) clearInterval(timerId);
    timerId = null;
  }

  function startTimer(){
    stopTimer();
    running = true;
    startedAt = performance.now();
    timerId = setInterval(() => {
      timeLeft = Math.max(0, timeLeft - 0.1);
      renderTime(timeLeft);
      if(timeLeft <= 0){
        stopTimer();
        endGame(false, "â° ì‹œê°„ ë! ëƒ‰ì¥ê³  ë¬¸ ë‹«í˜â€¦");
      }
    }, 100);
  }

  function buildEmptyGrid(){
    tiles = [];
    gridEl.innerHTML = "";
    targetsEl.innerHTML = "";
    openedCount = 0;
    openedEl.textContent = "0";

    const total = diff.cols * diff.rows;
    for(let i=0;i<total;i++){
      tiles.push({ value:"", open:false, hitType:null });
      const btn = document.createElement("button");
      btn.className = "tileBtn closed";
      btn.type = "button";
      btn.setAttribute("aria-label", "closed tile");
      btn.dataset.idx = String(i);
      btn.textContent = "â„ï¸";
      btn.addEventListener("click", onTileClick);
      gridEl.appendChild(btn);
    }
  }

  function pickTargets(){
    const pool = shuffle([...FOOD_POOL]);
    return pool.slice(0, 3);
  }

  function placeValues(){
    const total = diff.cols * diff.rows;
    const values = new Array(total).fill(null);

    // 1) place targets (at least one each)
    const positions = shuffle([...Array(total)].map((_,i)=>i));
    targets.forEach((t, k) => {
      values[positions[k]] = t;
    });

    // 2) fill rest with random foods or BAD
    for(let i=0;i<total;i++){
      if(values[i] != null) continue;
      const badRoll = Math.random() < diff.badRate;
      values[i] = badRoll ? BAD : FOOD_POOL[rand(FOOD_POOL.length)];
    }

    // 3) assign to tiles
    for(let i=0;i<total;i++){
      tiles[i].value = values[i];
      tiles[i].open = false;
      tiles[i].hitType = null;
    }
  }

  function renderTargets(){
    targetsEl.innerHTML = "";
    targets.forEach(t => {
      const el = document.createElement("div");
      el.className = "target";
      el.dataset.t = t;
      el.innerHTML = `<span style="font-size:18px">${t}</span><span style="font-weight:850">find</span>`;
      targetsEl.appendChild(el);
    });
  }

  function markTargetDone(t){
    const el = targetsEl.querySelector(`.target[data-t="${CSS.escape(t)}"]`);
    if(el) el.classList.add("done");
  }

  function openTile(i, reason="click"){
    const tile = tiles[i];
    if(tile.open) return;

    tile.open = true;
    openedCount++;
    openedEl.textContent = String(openedCount);

    const btn = gridEl.children[i];
    btn.classList.remove("closed");
    btn.classList.add("open");
    btn.textContent = tile.value;

    if(tile.value === BAD){
      tile.hitType = "bad";
      btn.classList.add("bad");
      timeLeft = Math.max(0, timeLeft - diff.penalty);
      renderTime(timeLeft);
      setMessage(`ğŸ¤¢ ìœ í†µê¸°í•œâ€¦ -${diff.penalty}s`);
      // ì‘ì€ í”ë“¤ë¦¼
      btn.classList.add("shake");
      setTimeout(()=>btn.classList.remove("shake"), 260);
      return;
    }

    // target?
    if(targets.includes(tile.value) && !found.has(tile.value)){
      found.add(tile.value);
      tile.hitType = "good";
      btn.classList.add("good");
      markTargetDone(tile.value);
      setMessage(`âœ… ${tile.value} ì°¾ì•˜ë‹¤! (${found.size}/3)`);
      if(found.size === 3){
        stopTimer();
        const clearSec = (performance.now() - startedAt) / 1000;
        endGame(true, `ğŸ‰ í´ë¦¬ì–´! (ê±¸ë¦° ì‹œê°„: ${formatSec(clearSec)})`, clearSec);
      }
    }else{
      setMessage("ëƒ â€¦ ê·¼ë° ì˜¤ëŠ˜ì˜ ì†Œì›ì€ ì•„ë‹˜ ğŸ˜‹");
    }
  }

  function onTileClick(e){
    if(!running){
      setMessage("New Gameì„ ëˆŒëŸ¬ ì‹œì‘í•´ì¤˜!");
      return;
    }
    const i = Number(e.currentTarget.dataset.idx);
    openTile(i);
  }

  function endGame(win, message, clearSec=null){
    setMessage(message);

    // ëª¨ë‘ ì—´ì–´ì£¼ê¸° (ê²°ê³¼ ê³µê°œ)
    for(let i=0;i<tiles.length;i++){
      if(!tiles[i].open){
        const btn = gridEl.children[i];
        btn.classList.remove("closed");
        btn.classList.add("open");
        btn.textContent = tiles[i].value;
        tiles[i].open = true;
      }
    }

    // best ê°±ì‹ 
    if(win && clearSec != null){
      const best = loadBest();
      if(best == null || clearSec < best){
        saveBest(clearSec);
        renderBest();
        setMessage(message + " ğŸ† NEW BEST!");
      }
    }
  }

  function newGame(){
    stopTimer();
    diff = DIFFS[diffKey];

    totalTime = diff.time;
    timeLeft = diff.time;
    renderTime(timeLeft);

    found = new Set();
    openedCount = 0;
    openedEl.textContent = "0";
    peekLockedUntil = 0;

    targets = pickTargets();
    renderTargets();

    placeValues();

    // reset UI grid to closed
    for(let i=0;i<tiles.length;i++){
      tiles[i].open = false;
      tiles[i].hitType = null;
      const btn = gridEl.children[i];
      btn.className = "tileBtn closed";
      btn.textContent = "â„ï¸";
    }

    setMessage("Start! ëƒ‰ì¥ê³ ì—ì„œ ì†Œì› 3ê°œë¥¼ ì°¾ì•„!");
    startTimer();
  }

  function peek(){
    if(!running){
      setMessage("New Game í›„ì— Peek ê°€ëŠ¥!");
      return;
    }
    const now = Date.now();
    if(now < peekLockedUntil){
      const left = Math.ceil((peekLockedUntil - now)/1000);
      setMessage(`Peek ì¿¨ë‹¤ìš´â€¦ ${left}s`);
      return;
    }
    peekLockedUntil = now + diff.peekCooldown * 1000;

    // 1ì´ˆê°„ ë¯¸ë¦¬ë³´ê¸°(ì—´ë¦¬ì§€ ì•Šì€ ì¹¸ë„ ë³´ì´ê²Œ)
    const prev = [];
    for(let i=0;i<tiles.length;i++){
      const btn = gridEl.children[i];
      prev.push(btn.textContent);
      if(!tiles[i].open) btn.textContent = tiles[i].value;
    }
    setMessage("ğŸ‘€ ëƒ‰ì¥ê³  ë¬¸ OPEN (1s)");
    setTimeout(() => {
      for(let i=0;i<tiles.length;i++){
        const btn = gridEl.children[i];
        if(!tiles[i].open) btn.textContent = "â„ï¸";
      }
      setMessage("ë¬¸ ë‹«í˜. ê¸°ì–µìœ¼ë¡œ ìŠ¹ë¶€í•´!");
    }, 1000);
  }

  // ===== Wire up buttons =====
  newBtn.addEventListener("click", () => newGame());
  peekBtn.addEventListener("click", () => peek());
  resetBestBtn.addEventListener("click", () => {
    localStorage.removeItem(STORAGE_BEST);
    renderBest();
    setMessage("Best ê¸°ë¡ ì´ˆê¸°í™”!");
  });

  easyBtn.addEventListener("click", () => setDiff("easy"));
  normalBtn.addEventListener("click", () => setDiff("normal"));
  hardBtn.addEventListener("click", () => setDiff("hard"));

  // ===== Init =====
  renderBest();
  setDiff("normal");
  buildEmptyGrid();
})();
</script>
</body>
</html>
